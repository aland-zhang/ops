一、常规配置
1、查看
ulimit -a

2、调整
/etc/security/limits.d/90-nproc.conf
/etc/security/limits.conf

3、常规配置

*          soft    nofile    65535 
*          hard    nofile    65535
*          soft    core      unlimited

*          soft    nproc     4096
root       soft    nproc     unlimited


二、问题
1、关于进程数量的统计

场景：
su jack -c "ulimit -n" 执行失败
    
为何会执行失败呢？继续分析。

默认值：
nproc: 1024

[root@test ~]# su jack
su: cannot set user id: Resource temporarily unavailable

ulimit 
-u     The maximum number of processes available to a single user
ps
-L              Show threads, possibly with LWP and NLWP columns

[root@test ~]# ps -u jack |wc -l
421
[root@test ~]# ps -u jack -L |wc -l
1151

显然，算上了线程数量。
结论：调整 nproc 的上限。

参考：https://access.redhat.com/solutions/30316


