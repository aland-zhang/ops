pipeline {
  agent {
    node {
      # 这个 label 是在 node 上定义的
      label 'pipeline'
      # 执行 job 时，代码在这个路径下
      customWorkspace '/var/jenkins_home/workspace/CICD_DEMO_build/src/abc.com'
    }
  }

  parameters {
    # 定义参数
    string(name: 'svrName', defaultValue: 'empty', description: '')
    string(name: 'svrVar', defaultValue: 'empty', description: '')
  }

  tools {
    # type 为 go，别名为 go plugin 在 global tools configuration 下增加的一个 go tool 的别名
    go 'go19'
  }

  environment {
    # 定义环境变量
    GOPATH = "/var/jenkins_home/workspace/CICD_DEMO_build"
  }

  stages {
    stage('Prepare') {
      steps {
        echo 'Preparing..'
        echo "[+] --> Job: ${env.BUILD_URL}"
        echo "[-] --> Workspace: ${WORKSPACE}"
        sh 'go version'
        sh 'go env'
        echo "[-] --> List GOPATH: ${GOPATH}"
        sh 'ls ${GOPATH}'
      }
    }
    stage('Build') {
      steps {
        echo 'Building..'
        echo "[-] --> params.svrName = ${params.svrName}"
        echo "[-] --> params.svrVar = ${params.svrVar}"
        sh 'echo $(pwd)'
        sh 'bash ./jenkins/scripts/build.sh'
      }
    }
    stage('Test') {
      steps {
        echo 'Testing..'
      }
    }
    stage('Deliver') {
      steps {
        echo 'Delivering....'
        # 通过一个弹窗来中断
        input 'Continue? (Click "Proceed" to continue)'
        echo 'Deploying....'
      }
    }
  }
}
